{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://hamlet.io/schema/latest/blueprint/component.json",

    "definitions": {

      "deployment-units" : {
        "type" : "array",
        "items" : {
          "type" : "string"
        }
      },

      "instances" : {
        "type" : "object",
        "additionalProperties": true,
        "properties": {
          "Versions" : {
            "type" : "object",
            "additionalProperties": true
          }
        }
      },

      "s3": {
        "type": "object",
        "properties": {
          "Instances" : { "$ref": "#/definitions/instances" },
          "DeploymentUnits" : { "$ref" : "#/definitions/deployment-units" },
          "Lifecycle": {
            "type": "object",
            "additionalProperties" : false,
            "properties": {
              "Expiration" : {
                "description": "Provide either a date or a number of days",
                "type" : [ "string", "number" ]
              },
              "Offline" : {
                "description" : "Provide either a date or a number of days",
                "type" : [ "string", "number" ]
              },
              "Versioning" : {
                "type" : "boolean",
                "default" : false
              }
            }
          },
          "Website" : {
            "type" : "object",
            "additionalProperties" : false,
            "properties": {
              "Index" : {
                "type" : "string",
                "default" : "index.html"
              },
              "Error" : {
                "type" : "string",
                "default" : ""
              }
            }
          },
          "PublicAccess" : {
            "type" : "object",
            "patternProperties": {
              "^[A-Za-z_][A-Za-z0-9_]*$" : {
                "type" : "object",
                "additionalProperties" : false,
                "properties": {
                  "Enabled" : {
                    "type" : "boolean",
                    "default" : false
                  },
                  "Permissions" : {
                    "type" : "string",
                    "enum": [ "ro", "wo", "rw"],
                    "default" : "ro"
                  },
                  "IPAddressGroups" : {
                    "type" : "array",
                    "items": {
                      "type" : "string"
                    },
                    "default" : [ "_localnet"]
                  },
                  "Paths" : {
                    "type" : "array",
                    "items": {
                      "type" : "string"
                    },
                    "default" : []
                  }
                }
              }
            }
          },
          "Style" : {
            "description": "TODO(mfl): Think this can be removed",
            "type" : "string"
          },
          "Notifications" : {
                "type" : "object",
                "patternProperties": {
                  "^[A-Za-z_][A-Za-z0-9_]*$" : {
                    "type" : "object",
                    "additionalProperties" : false,
                    "properties": {
                      "Prefix" : {
                        "type" : "string"
                      },
                      "Suffix" : {
                        "type" : "string"
                      },
                      "Events" : {
                        "type" : "array",
                        "default" : [ "create" ],
                        "items" : {
                          "type" : "string",
                          "enum": [ "create", "delete", "restore", "reducedredundancy"]
                        }
                      }
                    }
                  }
            },
            "additionalProperties": false
          },
          "additionalProperties" : false
        }
      },

      "template" : {
        "type" : "object",

        "properties": {
          "Instances" : { "$ref": "#/definitions/instances" },
          "DeploymentUnits" : { "$ref" : "#/definitions/deployment-units" },
          "RootFile" : {
            "type" : "string",
            "description": "The name of the root template file in the build aretefact"
          },
          "Fragment" : {
            "type" : "string"
          },
          "Parameters" : {
            "type" : "object",
            "patternProperties": {
              "^[A-Za-z_][A-Za-z0-9_]*$" : {
                "additionalProperties" : false,
                "type" : "object",
                "properties": {
                  "Key" : {
                    "type" : "string"
                  },
                  "Value" : {
                    "type" : "string"
                  }
                },

                "required": [ "Key "]
              }
            }
          },
          "Attributes" : {
            "type" : "object",
            "patternProperties" : {
              "^[A-Za-z_][A-Za-z0-9_]*$" : {
                "additionalProperties" : false,
                "type" : "object",
                "properties" : {
                  "TemplateOutputKey" : {
                    "description": "The name of the template output you want to map to an attribte",
                    "type" : "string"
                  },
                  "AttributeType" : {
                    "description": "The output type to map the attribute with",
                    "enum": [ "dns", "arn", "url", "name", "ipaddress", "key", "port", "username", "password", "region"],
                    "type" : "string"
                  }
                },

                "required" : [ "TemplateOutputKey", "AttributeType" ]
              }
            }
          },
          "NetworkAccess" : {
            "type" : "boolean",
            "default" : false
          }
        },
        "additionalProperties": false,

        "required": [ "RootFile"]
      }

    },

    "type": "object",

    "patternProperties": {
      "^[A-Za-z0-9_-]*$" : {
        "properties": {
          "s3" : { "$ref" : "#/definitions/s3"},
          "template" : { "$ref" : "#/definitions/template"}
        },
        "additionalProperties": true
      }
    },

    "additionalProperties" : false
}
